---
// Testimonials Carousel Component
import WhatsAppIcon from './WhatsAppIcon.astro';

const testimonials = [
  {
    name: "María González",
    age: "Madre de Pablo, 8 años",
    text: "Alexandra ha sido increíble con mi hijo. En solo 3 meses hemos visto una mejora espectacular en su pronunciación de la 'r'. Es muy profesional y cariñosa.",
    rating: 5,
    service: "Articulación y Fonética"
  },
  {
    name: "Carlos Herrera",
    age: "Paciente adulto, 45 años",
    text: "Después de mi ictus pensé que no volvería a hablar con normalidad. Alexandra me devolvió la confianza y mi comunicación ha mejorado enormemente.",
    rating: 5,
    service: "Disfagia Adultos"
  },
  {
    name: "Ana Martín",
    age: "Profesora, 38 años",
    text: "Como profesora, mi voz es mi herramienta de trabajo. Las técnicas que me enseñó Alexandra me han permitido hablar todo el día sin fatiga vocal.",
    rating: 5,
    service: "Entrenamiento Vocal"
  },
  {
    name: "Luis Rodríguez",
    age: "Padre de Carmen, 6 años",
    text: "Nuestra hija tenía problemas para tragar correctamente. Alexandra nos guió en todo el proceso con mucha paciencia y profesionalidad.",
    rating: 5,
    service: "Deglución Infantil"
  }
];
---

<section id="testimonios" class="py-16 md:py-24 bg-gradient-to-br from-primary-50 to-secondary-50">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-16">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-display font-bold text-gray-900 mb-6">
        Lo que dicen mis <span class="text-primary-600">pacientes</span>
      </h2>
      <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
        Testimonios reales de familias y pacientes que han mejorado su calidad de vida
      </p>
    </div>

    <!-- Testimonials Carousel -->
    <div class="testimonials-carousel relative">
      <div class="testimonials-container">
        {testimonials.map((testimonial, index) => (
          <div class={`testimonial-card ${index === 0 ? 'active' : ''}`}>
            <div class="bg-white rounded-2xl p-8 shadow-xl border border-gray-100 hover:shadow-2xl transition-all duration-300">
              <!-- Stars -->
              <div class="flex items-center justify-center mb-6">
                {Array.from({ length: testimonial.rating }, (_, i) => (
                  <svg key={i} class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                  </svg>
                ))}
              </div>
              
              <!-- Quote -->
              <blockquote class="text-lg text-gray-700 leading-relaxed mb-6 text-center italic">
                "{testimonial.text}"
              </blockquote>
              
              <!-- Service badge -->
              <div class="flex justify-center mb-4">
                <span class="px-3 py-1 bg-primary-100 text-primary-800 text-sm font-medium rounded-full">
                  {testimonial.service}
                </span>
              </div>
              
              <!-- Author -->
              <div class="text-center">
                <div class="font-semibold text-gray-900">{testimonial.name}</div>
                <div class="text-sm text-gray-600">{testimonial.age}</div>
              </div>
            </div>
          </div>
        ))}
      </div>
      
      <!-- Navigation Dots -->
      <div class="flex justify-center mt-8 space-x-2">
        {testimonials.map((_, index) => (
          <button 
            class={`carousel-dot w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-primary-600 w-8' : 'bg-gray-300 hover:bg-primary-400'}`}
            data-slide={index}
          ></button>
        ))}
      </div>
      
      <!-- Navigation Arrows -->
      <button class="carousel-prev absolute left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      
      <button class="carousel-next absolute right-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>
    
    <!-- CTA Section -->
    <div class="text-center mt-16">
      <div class="bg-white rounded-2xl p-8 shadow-xl max-w-3xl mx-auto">
        <h3 class="text-2xl md:text-3xl font-display font-bold text-gray-900 mb-4">
          ¿Quieres ser el próximo en mejorar?
        </h3>
        <p class="text-lg text-gray-600 mb-8">
          Únete a las familias que ya han transformado su comunicación con mi ayuda profesional
        </p>
        <a 
          href="https://wa.me/34614417513?text=Hola%20Alexandra,%20he%20visto%20los%20testimonios%20y%20me%20gustar%C3%ADa%20una%20consulta" 
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center px-8 py-4 bg-primary-600 text-white text-lg font-semibold rounded-lg hover:bg-primary-700 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl"
        >
          <WhatsAppIcon class="w-6 h-6 mr-2 floating" />
          Solicitar Mi Consulta
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  .testimonials-carousel {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .testimonials-container {
    position: relative;
    height: 400px;
    overflow: hidden;
  }
  
  .testimonial-card {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    transform: translateX(100px);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }
  
  .testimonial-card.active {
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto;
  }
  
  .testimonial-card.prev {
    transform: translateX(-100px);
  }
  
  .carousel-dot {
    cursor: pointer;
  }
  
  @media (max-width: 768px) {
    .carousel-prev,
    .carousel-next {
      display: none;
    }
    
    .testimonials-container {
      height: auto;
      min-height: 400px;
    }
  }
</style>

<script>
  class TestimonialsCarousel {
    constructor() {
      this.currentSlide = 0;
      this.totalSlides = 4;
      this.autoplayInterval = null;
      this.init();
    }
    
    init() {
      this.bindEvents();
      this.startAutoplay();
    }
    
    bindEvents() {
      // Dots navigation
      const dots = document.querySelectorAll('.carousel-dot');
      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          this.goToSlide(index);
        });
      });
      
      // Arrow navigation
      const prevBtn = document.querySelector('.carousel-prev');
      const nextBtn = document.querySelector('.carousel-next');
      
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          this.prevSlide();
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          this.nextSlide();
        });
      }
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') this.prevSlide();
        if (e.key === 'ArrowRight') this.nextSlide();
      });
      
      // Pause autoplay on hover
      const carousel = document.querySelector('.testimonials-carousel');
      if (carousel) {
        carousel.addEventListener('mouseenter', () => {
          this.stopAutoplay();
        });
        
        carousel.addEventListener('mouseleave', () => {
          this.startAutoplay();
        });
      }
    }
    
    goToSlide(index) {
      // Remove active class from current slide
      const currentCard = document.querySelector('.testimonial-card.active');
      if (currentCard) {
        currentCard.classList.remove('active');
        currentCard.classList.add('prev');
        setTimeout(() => {
          currentCard.classList.remove('prev');
        }, 500);
      }
      
      // Add active class to new slide
      const newCard = document.querySelectorAll('.testimonial-card')[index];
      if (newCard) {
        setTimeout(() => {
          newCard.classList.add('active');
        }, 100);
      }
      
      // Update dots
      this.updateDots(index);
      
      this.currentSlide = index;
    }
    
    nextSlide() {
      const nextIndex = (this.currentSlide + 1) % this.totalSlides;
      this.goToSlide(nextIndex);
    }
    
    prevSlide() {
      const prevIndex = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
      this.goToSlide(prevIndex);
    }
    
    updateDots(activeIndex) {
      const dots = document.querySelectorAll('.carousel-dot');
      dots.forEach((dot, index) => {
        if (index === activeIndex) {
          dot.classList.add('bg-primary-600', 'w-8');
          dot.classList.remove('bg-gray-300');
        } else {
          dot.classList.remove('bg-primary-600', 'w-8');
          dot.classList.add('bg-gray-300');
        }
      });
    }
    
    startAutoplay() {
      this.autoplayInterval = setInterval(() => {
        this.nextSlide();
      }, 5000);
    }
    
    stopAutoplay() {
      if (this.autoplayInterval) {
        clearInterval(this.autoplayInterval);
        this.autoplayInterval = null;
      }
    }
  }
  
  // Initialize carousel when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      new TestimonialsCarousel();
    });
  } else {
    new TestimonialsCarousel();
  }
</script>